<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Decision Patterns" />

<meta name="date" content="2019-01-05" />

<title>Command Line Technical Specifications</title>






<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Command Line Technical Specifications</h1>
<h4 class="author"><em>Decision Patterns</em></h4>
<h4 class="date"><em>2019-01-05</em></h4>



<p>This document provides a language-agnostic specification about how application are invoked from an interactive terminal or a text-based/non-gui/batch system. It is intend for developers who wish to understand details and considerations about command-line parsing. It is unlikely to be of much value to end-users looking to add command-line parsing to their own applications. For the implementation in <em>optigrab</em>, please see the accompanying <em>Using Optigrab</em> document.</p>
<div id="anatomy-of-the-command-line" class="section level2">
<h2>Anatomy of the command-line:</h2>
<p>An innvocattion of command-line application commonly has this structure:</p>
<pre><code>[env] [interpreter] script  [verb] [options] [targets]
                           &lt;-------- arguments -------&gt;
&lt;------------------- command-line --------------------&gt;</code></pre>
<p>(Components in [bracket] are optional.)</p>
<p>The sections below, detail and discuss the considerations for parsing each of the components.</p>
<div id="environment-variable" class="section level3">
<h3>Environment Variable</h3>
<p>See (Wikipedia: Environment Variable)[<a href="https://en.wikipedia.org/wiki/Environment_variable" class="uri">https://en.wikipedia.org/wiki/Environment_variable</a>]</p>
<p>Things to note about environment variables: - inherited by child processed - implemented by the OS</p>
</div>
<div id="intepreter" class="section level3">
<h3>Intepreter</h3>
<p>The <em>interpreter</em> is the application that executes the <em>script</em>. The interpreter may be specified on the command line or There are numerous ways the interpreter may appear: <code>Rscript</code>, <code>R CMD BATCH</code>, r (little-r). On <em>nix systems the </em>interpreter* is optional and may be specified in the script through the #! (SHEBANG) syntax.</p>
</div>
<div id="script" class="section level3">
<h3>Script</h3>
<p>The <em>script</em> is the (path to the) program file/code to be run.</p>
</div>
<div id="arguments" class="section level3">
<h3>Arguments</h3>
<p>Collectively, <a href="#Arguments">arguments</a> refers to the [verb}(#Verb), <a href="#Options">options</a> and <a href="#targets">target(s)</a>. Each type of argument is handled in its own way.</p>
<div id="verb" class="section level4">
<h4>Verb</h4>
<p>A <em>verb</em> is a single optional command. (Not all applications use verbs; <em>git</em> is one popular application that does). The verb is the first value after the script and before any options.</p>
<p>The constraint that the verb is the first argument before any options is not universally followed. Some application allow placement of the verb anywhere so long as it is cannot be interpretted as part of an option. This introduces ambiguity with applications that allow the binding of multiple values to a name. This is inherently true of R since R atomistic object are vectors and not scalars.</p>
<p>Typically application allow only one verb. It might be easy to define verbs as all values that occur between the name of the script and the first flag (if any). If there are more than one verbs in the arguments array, the first is taken as the verb and a warning is issued</p>
</div>
<div id="options" class="section level4">
<h4>Options</h4>
<pre><code> [flag[=][value [value]] [flag[=][value [value]] [...]]]
 </code></pre>
<p>The <em>options</em> are the name-value(s) pairs that can be parsed into variables. Names are identified by a flag, usually a slight syntactical variation on the name such as preceeding it with one or two characters. “-” (Java-style), “–” (GNU-style) or “/” (Microsoft-style).</p>
<pre><code>-name
--name
/name</code></pre>
<p>Associated with each name can be zero, one or several values. If there are no values provided, the type of the variable is assumed to be boolean/logical and the value is taken as TRUE (1)</p>
<p>Parsing and the interpretaion of options are the focus of this library. Options occur after the <em>script</em> and any <em>verbs</em> and before any targets. The challenge of translating command-line options to variable in the program require several steps. The following conventions are used As an example consider the following simple innvocation:</p>
<pre><code>script --foo bar</code></pre>
<table>
<thead>
<tr class="header">
<th align="center">Component</th>
<th align="left">Example</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">command-line</td>
<td align="left">script.r –foo bar</td>
<td>referes to thte complete command-line: script, verb, etc.</td>
</tr>
</tbody>
</table>
<p>arguments verb options targets refer to the script arguments as they appear on the command line. By default they have no type.</p>
<p>opt_string ‘–foo bar’ string; options as they are typed at the command-line</p>
<p>opts <code>c('--foo', 'bar')</code> character vector; how options appear in <code>commandArgs</code></p>
<p>flag –foo how the flags can appear on the command line; not needed by the developer</p>
<p>name foo the name used for the option or variable</p>
<p>value bar the value of the variable</p>
</div>
<div id="targets" class="section level4">
<h4>Targets</h4>
<p>The <em>targets</em> are typically files or other resources that are affected by the commands. See <a href="#Target">Target</a>.</p>
<p>Targets are similar to the <a href="#Verb">verbs</a> in that they do not require much interpretation. Typically, they are one or more files or resources. Sometimes the expressions are globs.</p>
<p>Targets can be ambiguous since <em>option</em> can have an indefinite number of values. Consider the following command-line:</p>
<pre><code>script.r --foo 1 --bar my-file-1 my-file-2 </code></pre>
<p>In this example, it is unclear whether <code>my-file-1</code> and <code>my-file-2</code> should be associated with <code>--bar</code> or or targets or a combination.</p>
</div>
</div>
</div>
<div id="parsing" class="section level2">
<h2>Parsing</h2>
<p>Parsing command-line arguments is a bit more tricky than it may appear. Parsing involves severals steps:</p>
<ol style="list-style-type: decimal">
<li>Retrieve commandArgs()</li>
<li>Pre-process command-line according to the style</li>
<li>Parsing command-line: script <a href="#options">verb</a> <a href="#targets">targets</a> ** Identify script (this_file) ** Identify verb (if exists)<br />
** Parsing options (according to specifications) *** Differentiate flags from values *** Define variabels / assign names and values ** Disambuigate target(s) from options</li>
</ol>
</div>
<div id="opt_fill-filling-recursive-structures" class="section level2">
<h2>opt_fill Filling recursive structures</h2>
<p><code>opt_fill</code> gets values from the command-line using an existing recursive object as a template. Values in the existing recursive structure may be clobberred/overwritten or created. There are several use cases:</p>
<ul>
<li><p><code>clobber == TRUE</code>: command-line application in which <code>opts</code> are overwritting application defaults.</p></li>
<li><p><code>clobber == TRUE &amp;&amp; create == TRUE</code>: same as above, but also get other missing commands such as</p></li>
</ul>
<p>Reursive structures have several options for filling based on <code>opts</code>.</p>
<ul>
<li>Only fill existing names in <code>x</code> name exists x/opts: TRUE FALSE<br />
——– ————————- ——- TRUE Clobber(?) or not Keep x as default FALSE Create(?) Keep x as default</li>
</ul>
<p>It seems there are two use-case.</p>
<ol style="list-style-type: decimal">
<li><code>x</code> is defaults; values should be clobbered and set.</li>
<li><code>x</code> is set; alternative values should be set</li>
</ol>
<p><code>.clobber</code> and <code>.create</code></p>
<p><em>clobber</em>: if <code>x</code> exists is the value overwritten.</p>
<p>clobber &amp; create : clobber existing values; create new ones USE CASE: overwriting default, (commando)</p>
<p>clobber &amp; ! create : only clobber values USE CASE: x are all the values that we need …only get those. commando with mutliple commands and one config file, etc. (commando: multiple commands)</p>
<p>! clobber &amp; create : get new values (e.g. don’t change defaults) USE CASE: (rare) keep old values adding new ones</p>
<p>! clobber &amp; ! create : non-op (with warning) USE CASE: None</p>
</div>
<div id="references" class="section level2">
<h2>References</h2>
<p>(Wikipedia: Environment Variable)[<a href="https://en.wikipedia.org/wiki/Environment_variable" class="uri">https://en.wikipedia.org/wiki/Environment_variable</a>]</p>
</div>
<div id="appendix" class="section level2">
<h2>Appendix</h2>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
